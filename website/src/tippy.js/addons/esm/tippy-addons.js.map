{"version":3,"file":"tippy-addons.js","sources":["../../src/addons/delegate.ts","../../src/addons/createSingleton.ts"],"sourcesContent":["import { Targets, Instance, Props } from '../types'\nimport tippy from '..'\nimport { throwErrorWhen } from '../validation'\n\ninterface ListenerObj {\n  element: Element\n  eventType: string\n  listener: EventListener\n  options: boolean | object\n}\n\n/**\n * Creates a delegate instance that controls the creation of tippy instances\n * for child elements (`target` CSS selector).\n * Port of v4's `target` prop to a separate function.\n */\nexport default function delegate(\n  targets: Targets,\n  props: Props & { target: string },\n): Instance | Instance[] | null {\n  if (__DEV__) {\n    throwErrorWhen(\n      !props || !props.target,\n      'You must specify a `target` prop indicating the CSS selector string ' +\n        'matching the target elements that should receive a tippy.',\n    )\n  }\n\n  let listeners: ListenerObj[] = []\n  let childTippyInstances: Instance[] = []\n\n  const { target } = props\n  delete props.target\n\n  const instanceOrInstances = tippy(targets, props)\n\n  function onTrigger(event: Event): void {\n    if (event.target) {\n      const targetNode = (event.target as Element).closest(target)\n\n      if (targetNode) {\n        const instance = tippy(targetNode, { ...props, showOnInit: true })\n\n        if (instance) {\n          childTippyInstances = childTippyInstances.concat(instance)\n        }\n      }\n    }\n  }\n\n  function on(\n    element: Element,\n    eventType: string,\n    listener: EventListener,\n    options: object | boolean = false,\n  ): void {\n    element.addEventListener(eventType, listener, options)\n    listeners.push({\n      element,\n      eventType,\n      listener,\n      options,\n    })\n  }\n\n  function addEventListeners(instance: Instance): void {\n    const { reference } = instance\n    instance.props.trigger\n      .trim()\n      .split(' ')\n      .forEach(\n        (eventType): void => {\n          switch (eventType) {\n            case 'mouseenter': {\n              on(reference, 'mouseover', onTrigger)\n              break\n            }\n            case 'focus': {\n              on(reference, 'focusin', onTrigger)\n              break\n            }\n            case 'click': {\n              on(reference, 'click', onTrigger)\n            }\n          }\n        },\n      )\n  }\n\n  function removeEventListeners(listeners: ListenerObj[]): void {\n    listeners.forEach(\n      ({ element, eventType, listener, options }: ListenerObj): void => {\n        element.removeEventListener(eventType, listener, options)\n      },\n    )\n    listeners = []\n  }\n\n  function applyMutations(instance: Instance): void {\n    const originalDestroy = instance.destroy\n    instance.destroy = (shouldDestroyChildInstances: boolean = true): void => {\n      if (shouldDestroyChildInstances) {\n        childTippyInstances.forEach(\n          (instance): void => {\n            instance.destroy()\n          },\n        )\n      }\n      childTippyInstances = []\n\n      removeEventListeners(listeners)\n      originalDestroy()\n    }\n\n    addEventListeners(instance)\n\n    instance.setProps({ trigger: 'manual' })\n  }\n\n  if (instanceOrInstances) {\n    if (Array.isArray(instanceOrInstances)) {\n      const instances = instanceOrInstances\n      instances.forEach(applyMutations)\n    } else {\n      const instance = instanceOrInstances\n      applyMutations(instance)\n    }\n  }\n\n  return instanceOrInstances\n}\n","import { Instance } from '../types'\nimport tippy from '..'\nimport { getValue, hasOwnProperty } from '../utils'\nimport { throwErrorWhen } from '../validation'\n\ninterface InstanceMaybePartOfSingleton extends Instance {\n  __singleton__?: boolean\n}\n\n/**\n * Re-uses a single tippy element for many different tippy instances.\n * Replaces v4's `tippy.group()`.\n */\nexport default function createSingleton(\n  tippyInstances: InstanceMaybePartOfSingleton[],\n  optionalProps: { delay: number | [number, number] } = { delay: 0 },\n): Instance {\n  if (__DEV__) {\n    if (!Array.isArray(tippyInstances)) {\n      throwErrorWhen(\n        !tippyInstances,\n        'First argument to `createSingleton()` must be an array of tippy ' +\n          'instances. The passed value was `' +\n          tippyInstances +\n          '`',\n      )\n\n      throwErrorWhen(\n        // @ts-ignore\n        tippyInstances.reference && tippyInstances.reference._tippy,\n        'First argument to `createSingleton()` must be an *array* of tippy ' +\n          'instances. The passed value was a *single* tippy instance.',\n      )\n    }\n\n    const isAnyInstancePartOfExistingSingleton = tippyInstances.some(\n      (instance): boolean => hasOwnProperty(instance, '__singleton__'),\n    )\n\n    throwErrorWhen(\n      isAnyInstancePartOfExistingSingleton,\n      'The passed tippy instance(s) are already part of an existing ' +\n        'singleton instance. Make sure you destroy the previous singleton ' +\n        'before calling `createSingleton()` again.',\n    )\n\n    tippyInstances.forEach(\n      (instance): void => {\n        instance.__singleton__ = true\n      },\n    )\n  }\n\n  const singletonInstance = tippy(document.createElement('div')) as Instance\n  let { delay } = optionalProps\n\n  let showTimeout: any\n  let hideTimeout: any\n  let onTrigger: (instance: Instance, event: Event) => void\n  let onUntrigger: (instance: Instance, event: Event) => void\n\n  function clearTimeouts(): void {\n    clearTimeout(showTimeout)\n    clearTimeout(hideTimeout)\n  }\n\n  tippyInstances.forEach(\n    (instance): void => {\n      // To prevent bugs with `hideOnClick`, we need to let the original tippy\n      // instance also go through its lifecycle (i.e. be mounted to the DOM as\n      // well). To prevent it from being seen/overlayed over the singleton\n      // tippy, we can set its opacity to 0\n      instance.popper.style.opacity = '0'\n\n      onTrigger = instance.props.onTrigger\n      onUntrigger = instance.props.onUntrigger\n\n      const originalClearDelayTimeouts = instance.clearDelayTimeouts\n      instance.clearDelayTimeouts = (): void => {\n        originalClearDelayTimeouts()\n        clearTimeouts()\n      }\n\n      instance.setProps({\n        delay: 0,\n        onTrigger(instance, event): void {\n          onTrigger(instance, event)\n\n          const props = { ...instance.props }\n          delete props.delay\n\n          singletonInstance.setProps(props)\n\n          singletonInstance.reference.getBoundingClientRect = ():\n            | DOMRect\n            | ClientRect => {\n            return instance.reference.getBoundingClientRect()\n          }\n\n          clearTimeouts()\n          // Edge case: if the tippy is currently hiding (but still mounted and\n          // visible due to its opacity), it will slide to the new reference\n          // element but fully to fade out before fading back in.\n          // Also, we need to ensure the `popper` element doesn't set its\n          // `transitionDuration` to 0ms, so it can transition smoothly\n          if (\n            !singletonInstance.state.isVisible &&\n            singletonInstance.state.isMounted\n          ) {\n            singletonInstance.show(undefined, false)\n          } else {\n            showTimeout = setTimeout((): void => {\n              singletonInstance.show()\n            }, getValue(delay, 0, tippy.defaultProps.delay))\n          }\n        },\n        onUntrigger(instance, event): void {\n          onUntrigger(instance, event)\n\n          clearTimeouts()\n          hideTimeout = setTimeout((): void => {\n            singletonInstance.hide()\n          }, getValue(delay, 1, tippy.defaultProps.delay))\n        },\n      })\n\n      // Ensure the lifecycles functions are updateable\n      const originalSetProps = instance.setProps\n      instance.setProps = (partialProps): void => {\n        // `delay` can't be updated\n        delete partialProps.delay\n\n        originalSetProps(partialProps)\n\n        onTrigger = partialProps.onTrigger || onTrigger\n        onUntrigger = partialProps.onUntrigger || onUntrigger\n      }\n    },\n  )\n\n  const originalSetProps = singletonInstance.setProps\n  singletonInstance.setProps = (partialProps): void => {\n    delay = partialProps.delay !== undefined ? partialProps.delay : delay\n    originalSetProps(partialProps)\n  }\n\n  const originalDestroy = singletonInstance.destroy\n  singletonInstance.destroy = (\n    shouldDestroyPassedInstances: boolean = true,\n  ): void => {\n    tippyInstances.forEach(\n      (instance): void => {\n        // Reset the original lifecycle hooks to prevent stack overflow if\n        // calling again.\n        // Note: users must always destroy the singleton instance before calling\n        // `createSingleton()` again on the same instances.\n        instance.setProps({\n          onTrigger,\n          onUntrigger,\n        })\n\n        if (__DEV__) {\n          delete instance.__singleton__\n        }\n\n        if (shouldDestroyPassedInstances) {\n          instance.destroy()\n        }\n      },\n    )\n\n    originalDestroy()\n  }\n\n  return singletonInstance\n}\n"],"names":["delegate","targets","props","throwErrorWhen","target","listeners","childTippyInstances","instanceOrInstances","tippy","onTrigger","event","targetNode","closest","instance","showOnInit","concat","on","element","eventType","listener","options","addEventListener","push","addEventListeners","reference","trigger","trim","split","forEach","removeEventListeners","removeEventListener","applyMutations","originalDestroy","destroy","shouldDestroyChildInstances","setProps","Array","isArray","instances","createSingleton","tippyInstances","optionalProps","delay","_tippy","isAnyInstancePartOfExistingSingleton","some","hasOwnProperty","__singleton__","singletonInstance","document","createElement","showTimeout","hideTimeout","onUntrigger","clearTimeouts","clearTimeout","popper","style","opacity","originalClearDelayTimeouts","clearDelayTimeouts","getBoundingClientRect","state","isVisible","isMounted","show","undefined","setTimeout","getValue","defaultProps","hide","originalSetProps","partialProps","shouldDestroyPassedInstances"],"mappings":"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"}